# Docker Compose for testing grincel in a Linux container
#
# Usage:
#   1. Build locally: zig build -Dtarget=x86_64-linux-gnu -Doptimize=ReleaseFast
#   2. Copy binary:   cp zig-out/bin/grincel .
#   3. Build image:   docker compose build
#   4. Run:           docker compose run grincel <pattern>

services:
  grincel:
    build:
      context: .
      dockerfile: Dockerfile
    # Enable GPU passthrough for Vulkan
    devices:
      - /dev/dri:/dev/dri
    # Vulkan ICD loader needs access to GPU
    environment:
      - VK_ICD_FILENAMES=/usr/share/vulkan/icd.d/radeon_icd.x86_64.json:/usr/share/vulkan/icd.d/nvidia_icd.json:/usr/share/vulkan/icd.d/intel_icd.x86_64.json
    volumes:
      # Mount output directory for generated keypairs
      - ./output:/output
    working_dir: /output
